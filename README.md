# Задание
1. Развернуть кластер elasticsearch (минимум 3 вм)
1. Настроить сбор логов со всех серверов проекта (веб-сервера, балансеры, базы данных)

# Подготовка к запуску
Публичный ключ должен находиться по пути: ```~/.ssh/id_rsa.pub```

В системе должны быть установлены ansible и terraform. Тестировалось на версиях:
* ansible [core 2.13.8]
* terraform v1.5.5

# Настройка и запуск
* склонировать репозиторий;
* настроить подключение к облаку яндекс. Для этого перейти в каталог ```terraform``` создать файл ```yc.auto.tfvars``` с содержимым (подставить свой токен, id облака и каталога):

```
yc_token     = токен
yc_cloud_id  = id облака
yc_folder_id = id каталога
```

* инициализировать терраформ: ```terraform init```
* запустить создание инфраструктуры: ```terraform apply```
* после создания инфраструктуры дождаться загрузки ВМ
* перейти в каталог ```ansible``` и запустить плейбук: ```ansible-playbook setup.yaml```:
  * при необходимости переопределить пароли: ```-e "admin_password=admin kibanaserver_password=kibana logstash_password=logstash"```
* при успешном выполнении плейбука в выводе terraform взять ip-адрес из ```nginx_public_ip_address``` и подключиться по http:
  * в основном location будет доступно приложение WordPress
  * в location ```os``` будет доступен Dashboards (можно переопределить в переменной ```os_prefix```)

# Пояснения

Инфраструктура проекта взята из задания 4:

```
                ┌───────── app0 ─────────┐
client <─────> lb0                      db0
                └───────── app1 ─────────┘
```

* роли для установки OpenSearch скопированы из [репозитория](https://github.com/opensearch-project/ansible-playbook) в каталог ```roles```.
* кластер OpenSearch состоит из трех нод: os0-2. 
* Dashboards развертываются на ноде os0.
* Logstash развертывается на нодах os0-2.
* Filebeat устанавливается на сервера инфраструктуры: lb0, app0-1, db0.
